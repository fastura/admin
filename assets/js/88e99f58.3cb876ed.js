"use strict";(self.webpackChunkfastura=self.webpackChunkfastura||[]).push([[366],{4137:(e,r,n)=>{n.d(r,{Zo:()=>c,kt:()=>v});var o=n(7294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function t(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?t(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function i(e,r){if(null==e)return{};var n,o,a=function(e,r){if(null==e)return{};var n,o,a={},t=Object.keys(e);for(o=0;o<t.length;o++)n=t[o],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(o=0;o<t.length;o++)n=t[o],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),d=function(e){var r=o.useContext(l),n=r;return e&&(n="function"==typeof e?e(r):s(s({},r),e)),n},c=function(e){var r=d(e.components);return o.createElement(l.Provider,{value:r},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var r=e.children;return o.createElement(o.Fragment,{},r)}},m=o.forwardRef((function(e,r){var n=e.components,a=e.mdxType,t=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=d(n),m=a,v=u["".concat(l,".").concat(m)]||u[m]||p[m]||t;return n?o.createElement(v,s(s({ref:r},c),{},{components:n})):o.createElement(v,s({ref:r},c))}));function v(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var t=n.length,s=new Array(t);s[0]=m;var i={};for(var l in r)hasOwnProperty.call(r,l)&&(i[l]=r[l]);i.originalType=e,i[u]="string"==typeof e?e:a,s[1]=i;for(var d=2;d<t;d++)s[d]=n[d];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},8471:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>d});var o=n(7462),a=(n(7294),n(4137));const t={},s="Migraci\xf3n de su proyecto entre servidores",i={unversionedId:"guias-adicionales/migracion-entre-servidores",id:"guias-adicionales/migracion-entre-servidores",title:"Migraci\xf3n de su proyecto entre servidores",description:"En esta secci\xf3n se presentar\xe1 como migrar un proyecto de un servidor a otro.",source:"@site/docs/guias-adicionales/05-migracion-entre-servidores.md",sourceDirName:"guias-adicionales",slug:"/guias-adicionales/migracion-entre-servidores",permalink:"/admin/guias-adicionales/migracion-entre-servidores",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Migracion del Pro5 a Pro6",permalink:"/admin/guias-adicionales/migracion-pro5-pro6"},next:{title:"Cambios en la base de datos referentes a direcciones",permalink:"/admin/Actualizaci\xf3n/Cambio-base-datos-direcciones"}},l={},d=[{value:"Tener en cuenta",id:"tener-en-cuenta",level:2},{value:"Pasar datos dentro de un servidor a otro",id:"pasar-datos-dentro-de-un-servidor-a-otro",level:2},{value:"Configurar archivos",id:"configurar-archivos",level:2},{value:"Editar el archivo de docker-compose",id:"editar-el-archivo-de-docker-compose",level:3},{value:"Cambiar el puerto de FPM dentro del proxy",id:"cambiar-el-puerto-de-fpm-dentro-del-proxy",level:3},{value:"Cambiar el host de la base de datos en el .env",id:"cambiar-el-host-de-la-base-de-datos-en-el-env",level:3},{value:"Posibles errores",id:"posibles-errores",level:2},{value:"Identificar posibles errores",id:"identificar-posibles-errores",level:3}],c={toc:d},u="wrapper";function p(e){let{components:r,...n}=e;return(0,a.kt)(u,(0,o.Z)({},c,n,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"migraci\xf3n-de-su-proyecto-entre-servidores"},"Migraci\xf3n de su proyecto entre servidores"),(0,a.kt)("p",null,"En esta secci\xf3n se presentar\xe1 como migrar un proyecto de un servidor a otro."),(0,a.kt)("h2",{id:"tener-en-cuenta"},"Tener en cuenta"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"En el servidor se tiene que revisar que puertos y nombres del contenedor esta disponible para evitar conflictos.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Tener un backup de sus datos."))),(0,a.kt)("h2",{id:"pasar-datos-dentro-de-un-servidor-a-otro"},"Pasar datos dentro de un servidor a otro"),(0,a.kt)("p",null,"Con los siguientes comandos traslada sus datos al otro servidor."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Copia los certificados del proyecto\nrsync -avzh /root/certs {ip del servidor a migrar}:/root/ \n\n# Copia el el datos del proxy del proyecto al servidor\nrsync -avzh /root/proxy {ip del servidor a migrar}:/root/              \n\n# Copia todo el proyecto al root del servidor\nrsync -avzh -q /root/ {ip del servidor a migrar}:/root/                \n\n# Copia los volumenes de la base de datos\nrsync -avzh -q /var/lib/docker/volumes/ {ip del servidor a migrar}:/var/lib/docker/volumes/ \n")),(0,a.kt)("p",null,"Una vez se haya terminado la transferencia de datos, tiene que dirigrse dentro de ",(0,a.kt)("inlineCode",{parentName:"p"},"cd /var/lib/docker/volumes/"),", ac\xe1 se encontrar\xe1 las carpetas de mysql y redis."),(0,a.kt)("p",null,"Se tiene que cambiar los nombre de la carepta respecto a lo que se ha elegido previamente. Con estos comandos se puede cambiar los nombres de la carpeta."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"#Se esta usando nombres de ejemplos\n# |nombre de carpeta actual | nombre de carpeta modificada |    \nmv pro6.buho.xyz_mysqldata1   pro6.buho.xyz_mysqldata2\n")),(0,a.kt)("h2",{id:"configurar-archivos"},"Configurar archivos"),(0,a.kt)("p",null,"Antes de levantar el proyecto, se tiene que configurar algunos archivos."),(0,a.kt)("h3",{id:"editar-el-archivo-de-docker-compose"},"Editar el archivo de docker-compose"),(0,a.kt)("p",null,"En este ejemplo se tomar\xe1 como ejemplo que la carpeta tenga el nombre de ",(0,a.kt)("strong",{parentName:"p"},"pro6.buho.xyz"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="docker-compose.yml"',title:'"docker-compose.yml"'},'version: \'3\'\n\nservices:\n    nginx{numero nuevo}:\n        image: rash07/nginx\n        container_name: nginx_pro6_buho_xyz\n        working_dir: /var/www/html\n        environment:\n            VIRTUAL_HOST: pro6.buho.xyz, *.pro6.buho.xyz\n        volumes:\n            - ./:/var/www/html\n            - /root/proxy/fpms/pro6.buho.xyz:/etc/nginx/sites-available\n        restart: always\n    fpm{numero nuevo}:\n        image: rash07/php-fpm:2.0\n        container_name: fpm_pro6_buho_xyz\n        working_dir: /var/www/html\n        volumes:\n            - ./ssh:/root/.ssh\n            - ./ssh:/var/www/.ssh\n            - ./:/var/www/html\n        restart: always\n    mariadb{numero nuevo}:\n        image: mariadb:10.5.6\n        container_name: mariadb_pro6_buho_xyz\n        environment:\n            - MYSQL_USER=\\${MYSQL_USER}\n            - MYSQL_PASSWORD=\\${MYSQL_PASSWORD}\n            - MYSQL_DATABASE=\\${MYSQL_DATABASE}\n            - MYSQL_ROOT_PASSWORD=\\${MYSQL_ROOT_PASSWORD}\n            - MYSQL_PORT_HOST=\\${MYSQL_PORT_HOST}\n        volumes:\n            - mysqldata{numero nuevo}:/var/lib/mysql\n        ports:\n            - "\\${MYSQL_PORT_HOST}:3306"\n        restart: always\n    redis{numero nuevo}:\n        image: redis:alpine\n        container_name: redis_pro6_buho_xyz\n        volumes:\n            - redisdata{numero nuevo}:/data\n        restart: always\n    scheduling{numero nuevo}:\n        image: rash07/scheduling\n        container_name: scheduling_pro6_buho_xyz\n        working_dir: /var/www/html\n        volumes:\n            - ./:/var/www/html\n        restart: always\n    supervisor{numero nuevo}:\n        image: rash07/php7.4-supervisor\n        container_name: supervisor_pro6_buho_xyz\n        working_dir: /var/www/html\n        volumes:\n            - ./:/var/www/html\n            - ./supervisor.conf:/etc/supervisor/conf.d/supervisor.conf\n        restart: always\n\nnetworks:\n    default:\n        external:\n            name: proxynet\n\nvolumes:\n    redisdata{numero nuevo}:\n        driver: "local"\n    mysqldata{numero nuevo}:\n        driver: "local"\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"En el ejemplo de arriba, el texto de ",(0,a.kt)("strong",{parentName:"li"},'"{numero nuevo}"'),", se tiene que cambiar a un nombre disponible (por ejemplo ",(0,a.kt)("strong",{parentName:"li"},"nginx12"),") que se encunetra dentro de tu servidor. Puedes nombrar los contenedores con ",(0,a.kt)("inlineCode",{parentName:"li"},"docker ps"),".")),(0,a.kt)("h3",{id:"cambiar-el-puerto-de-fpm-dentro-del-proxy"},"Cambiar el puerto de FPM dentro del proxy"),(0,a.kt)("p",null,"Tienes que dirigir a ",(0,a.kt)("inlineCode",{parentName:"p"},"cd ~/proxy/fpms/{nombre de tu proyecto}/"),", se ver\xe1 el archivo ",(0,a.kt)("strong",{parentName:"p"},"default"),", ingresa con ",(0,a.kt)("inlineCode",{parentName:"p"},"nano default"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-nginx",metastring:'title="default"',title:'"default"'},"server {\n    listen 80 default_server;\n    root /var/www/html/public;\n    index index.html index.htm index.php;\n    server_name *._;\n    charset utf-8;\n    server_tokens off;\n    location = /favicon.ico {\n        log_not_found off;\n        access_log off;\n    }\n    location = /robots.txt {\n        log_not_found off;\n        access_log off;\n    }\n    location / {\n        try_files $uri $uri/ /index.php$is_args$args;\n    }\n    location ~ \\.php$ {\n        include snippets/fastcgi-php.conf;\n        fastcgi_pass fpm{numero nuevo}:9000;\n        fastcgi_read_timeout 3600;\n    }\n    error_page 404 /index.php;\n    location ~ /\\.ht {\n        deny all;\n    }\n}\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"En la ",(0,a.kt)("strong",{parentName:"li"},"fastcgi_pass")," se tiene que cambiar con el nombre que se puso para el fpm dentro del docker-compose.")),(0,a.kt)("h3",{id:"cambiar-el-host-de-la-base-de-datos-en-el-env"},"Cambiar el host de la base de datos en el .env"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=".env"',title:'".env"'},"DB_HOST={nombre del contenedor de la base dedatos}\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"En ",(0,a.kt)("strong",{parentName:"li"},"DB_HOST")," se tiene que colocar el nombre de la base de datos que lo colocaste en el docker-compose.yml.")),(0,a.kt)("p",null,"Despu\xe9s de ello, tiene que buscar lo siguiente"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title=".env"',title:'".env"'},"MYSQL_PORT_HOST={puerto libre de tu vps}\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Aqu\xed debes colocar un puerto libre de tu sistema para que la base de datos funcione.")),(0,a.kt)("h2",{id:"posibles-errores"},"Posibles errores"),(0,a.kt)("h3",{id:"identificar-posibles-errores"},"Identificar posibles errores"),(0,a.kt)("p",null,"Para poder ver si hay errores dentro de los contenedores, primero visualizalos con ",(0,a.kt)("inlineCode",{parentName:"p"},"docker ps")),(0,a.kt)("p",null,"Si encuentras que dentro del rseultado, en uno de los contenedores dentro de us categor\xeda ",(0,a.kt)("strong",{parentName:"p"},"STATUS")," no aparece levntando (UP), entonces en ese contenedor hubo un error."),(0,a.kt)("p",null,"Para poder mostrar los logs del contenedor, puede usar el siguiente comando"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"docker logs --tail 20 {contenedor}\n")),(0,a.kt)("p",null,"Gracias a esto podemos revisar sus registros e identificar sus posibles errores."))}p.isMDXComponent=!0}}]);